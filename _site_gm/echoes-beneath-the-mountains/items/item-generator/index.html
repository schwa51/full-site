<!DOCTYPE html>
<html lang="en">
<head>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="UTF-8">
  <title>Item Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="https://use.typekit.net/abt0pgb.css">

  
    <link rel="stylesheet" href="/assets/css/theme-tor.css">
  
</head>



  

<!-- MOBILE NAVIGATION -->
<select
  id="mobile-nav"
  class="mobile-nav"
  onchange="if(this.value) window.location.href=this.value;"
>
  <option value="">Jump to…</option>
  
</select>

<body class="tor">


  <div class="layout-wrapper">
    <nav class="sidebar">
  
  

  <ul class="sidebar-nav">
    
      <li>
        <a
          href="/"
          class=""
        >
          Home
        </a>

        
        
          <ul>
            
              <li>
                <a
                  href="/vault/campaigns/mythic/"
                  class=""
                >
                  Mythic
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/timewatch/"
                  class=""
                >
                  Timewatch
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/wildsea/"
                  class=""
                >
                  Wildsea
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/echoes/"
                  class=""
                >
                  Echoes
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/dolmenwood/"
                  class=""
                >
                  Dolmenwood
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/mothership/"
                  class=""
                >
                  Mothership
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/pirateborg/"
                  class=""
                >
                  Pirateborg
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/tencandles/"
                  class=""
                >
                  Ten Candles
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/shadowdark/"
                  class=""
                >
                  Shadowdark
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/arkham-horror/"
                  class=""
                >
                  Arkham Horror
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/brindlewood/"
                  class=""
                >
                  Brindlewood Bay
                </a>

                
                
              </li>
            
              <li>
                <a
                  href="/vault/campaigns/mothership_oct/"
                  class=""
                >
                  Mothership October Oneshot
                </a>

                
                
              </li>
            
          </ul>
        
      </li>
    
  </ul>
</nav>


<main>
  <div class="page-title">
  <h1>Item Generator</h1>
  
</div>
  
  
<h1 class="sr-only">Item Generator</h1>

<section class="tor-card">
  <h2 class="tor-h">Generate an Item</h2>
  <form id="lookup-form" class="stack" novalidate>
    <label>
      Roll a d6
      <input id="num1" name="num1" type="number" min="1" max="6" required>
    </label>
    <label>
      Roll a d10
      <input id="num2" name="num2" type="number" min="1" max="10" required>
    </label>

    <div class="actions">
      <button type="submit">Find Result</button>
      <button type="button" id="roll">Roll Dice</button>
    </div>
  </form>

  <output id="result" role="status" aria-live="polite"></output>

  <details id="linkout" hidden>
    <summary>Share this exact result</summary>
    <p><a id="sharelink" href="#">Permalink with these rolls</a></p>
  </details>
</section>

<style>
  .stack { display: grid; gap: 0.75rem; max-width: 30rem; }
  .actions { display: flex; gap: 0.5rem; }
  #result { display: block; margin-top: 1rem; font-weight: 600; }
  .tor-card { padding: 1rem; border-radius: 0.75rem; box-shadow: 0 2px 10px rgba(0,0,0,.08); }
  .tor-h { margin: 0 0 .5rem; font-size: 1.25rem; }
  .tor-p { margin: 0 0 1rem; }
  .sr-only { position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; }
</style>
<script>
/**
 * Published TSV endpoint for your sheet.
 * If you ever need a specific tab, set SHEET_GID = "123456789".
 */
const SHEET_BASE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTB7J_s8evvvJA04UC4k6zzcSiuhiHWJmC1tpNTmSJcUL2H5mDd0sgb8P7MrxVLvLRwTKhMfm6M_uMt";
const SHEET_GID = ""; // keep blank for first visible tab
const TSV_URL = `${SHEET_BASE}/pub?single=true&output=tsv${SHEET_GID ? "&gid=" + SHEET_GID : ""}`;

async function fetchMatrix() {
  const res = await fetch(TSV_URL, { cache: "no-store" });
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  const text = await res.text();
  // Normalize newlines → rows, drop trailing blank line
  const lines = text.replace(/\r\n?/g, "\n").split("\n").filter(Boolean);
  // Split TSV into 2D matrix
  const matrix = lines.map(line => line.split("\t"));
  // No header row per your setup — if you add one later, use: return matrix.slice(1);
  return matrix;
}

function readInputs() {
  const n1 = parseInt(document.getElementById("num1").value, 10);
  const n2 = parseInt(document.getElementById("num2").value, 10);
  if (!Number.isInteger(n1) || n1 < 1 || n1 > 6) return null;
  if (!Number.isInteger(n2) || n2 < 1 || n2 > 10) return null;
  return { n1, n2 };
}

function lookup(matrix, n1, n2) {
  for (const row of matrix) {
    const a = Number(row[0]), b = Number(row[1]);
    if (Number.isFinite(a) && Number.isFinite(b) && a === n1 && b === n2) {
      return row[2] != null ? String(row[2]) : "";
    }
  }
  return null;
}

function rollDie(sides) { return Math.floor(Math.random() * sides) + 1; }

(async function init() {
  const form = document.getElementById("lookup-form");
  const out = document.getElementById("result");
  const rollBtn = document.getElementById("roll");
  const linkWrap = document.getElementById("linkout");
  const shareLink = document.getElementById("sharelink");

  let data = [];
  try {
    out.textContent = "Loading table…";
    data = await fetchMatrix();
    out.textContent = "";
  } catch (e) {
    console.error("Sheet load failed:", e);
    out.textContent = "Could not load the sheet. Open the TSV URL directly to verify publishing.";
    return;
  }

  function renderResult(text, n1, n2) {
    if (text !== null) {
      out.textContent = `Result: ${text}`;
      const url = new URL(location.href);
      url.searchParams.set("n1", String(n1));
      url.searchParams.set("n2", String(n2));
      shareLink.href = url.toString();
      linkWrap.hidden = false;
    } else {
      out.textContent = "No match found.";
      linkWrap.hidden = true;
    }
  }

  form.addEventListener("submit", e => {
    e.preventDefault();
    const vals = readInputs();
    if (!vals) {
      out.textContent = "Please enter a d6 (1–6) and a d10 (1–10).";
      linkWrap.hidden = true;
      return;
    }
    const result = lookup(data, vals.n1, vals.n2);
    renderResult(result, vals.n1, vals.n2);
  });

  if (rollBtn) {
    rollBtn.addEventListener("click", () => {
      const n1 = rollDie(6);
      const n2 = rollDie(10);
      document.getElementById("num1").value = n1;
      document.getElementById("num2").value = n2;
      const result = lookup(data, n1, n2);
      renderResult(result, n1, n2);
    });
  }

  // URL prefill: ?n1=2&n2=7
  const params = new URLSearchParams(location.search);
  if (params.has("n1")) document.getElementById("num1").value = params.get("n1");
  if (params.has("n2")) document.getElementById("num2").value = params.get("n2");
  if (params.has("n1") || params.has("n2")) form.dispatchEvent(new Event("submit"));
})();
</script>



  
  
</main>


  </div>

</body>
</html>
