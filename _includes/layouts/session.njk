{# _includes/layouts/session.njk #}
{% set sessId = data.session or page.fileSlug %}
{% set camp   = data.campaign %}

{% extends "layout.njk" %}
{% block content %}
  <article class="prose">
    <h1>{{ title }}</h1>
    {{ content | safe }}
  </article>
  <hr/>

  <p style="font-size:.9em;opacity:.7">
  DEBUG â€” campaign=<code>{{ data.campaign }}</code>,
  session=<code>{{ data.session }}</code>,
  in-campaign items={{ (collections.public_items | byCampaign(data.campaign)).length }},
  in-this-session items={{ (collections.public_items | byCampaign(data.campaign) | bySession(data.session)).length }}
</p>


  {% macro related(sectionTitle, coll) -%}
    <section>
      <h2>{{ sectionTitle }}{% if coll.length %} ({{ coll.length }}){% endif %}</h2>
      {% if coll.length %}
        <ul>
        {% for e in coll %}
          <li><a href="{{ e.url }}">{{ e | safeTitle }}</a></li>
        {% endfor %}
        </ul>
      {% else %}
        <p><em>None linked to this session yet.</em></p>
      {% endif %}
    </section>
  {%- endmacro %}

  {% set npcs  = collections.public_npcs      | byCampaign(camp) | bySession(sessId) %}
  {% set items = collections.public_items     | byCampaign(camp) | bySession(sessId) %}
  {% set lore  = collections.public_lore      | byCampaign(camp) | bySession(sessId) %}
  {% set locs  = collections.public_locations | byCampaign(camp) | bySession(sessId) %}

  {{ related("People met",        npcs)  }}
  {{ related("Items discovered",  items) }}
  {{ related("Lore & discoveries",lore)  }}
  {{ related("Locations visited", locs)  }}
{% endblock %}
