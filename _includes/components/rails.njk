{# rails.njk #}
{% macro tagRail(title, tag, campaignSlug=null, limit=null, base=[]) %}
  {# never read globals hereâ€”use only base #}
  {% set rows = base | byTag(tag) %}
  {% if campaignSlug %}{% set rows = rows | byCampaign(campaignSlug) %}{% endif %}
  {% set rows = rows | sortFeatured | slice(0, limit or rows.length) %}

  {% if rows.length %}
    <section>
      <h2>{{ title }}</h2>
      <ul class="list">
        {% for p in rows %}
          <li><a href="{{ p.url }}">{{ p.data.title }}</a></li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}
{% endmacro %}

{% macro pinRail(title, key, limit=null) %}
  {% set pins = (collections[key] or []) | sortFeatured %}
  {% if pins.length %}
    <section class="cards">
      <h2>{{ title }}</h2>
      {% for p in pins | slice(0, limit or pins.length) %}
        <article class="card">
          <h3><a href="{{ p.url }}">{{ p.data.title }}</a></h3>
          {% if p.data.summary %}<p class="muted">{{ p.data.summary }}</p>{% endif %}
        </article>
      {% endfor %}
    </section>
  {% endif %}
{% endmacro %}
