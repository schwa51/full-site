<nav class="sidebar">
  {% set navTree = collections.all | eleventyNavigation %}
  {% set currentUrl = page.url or '' %}

  <ul class="sidebar-nav">
    {% for item in navTree %}
      <li>
        <a
          href="{{ item.url }}"
          class="{% if currentUrl === item.url %}active{% endif %}"
        >
          {{ item.title }}
        </a>

        {# ── LEVEL 2 ── expand only if we’re somewhere under this item #}
        {% if item.children and item.url and currentUrl and currentUrl.startsWith(item.url) %}
          <ul>
            {% for child in item.children %}
              <li>
                <a
                  href="{{ child.url }}"
                  class="{% if currentUrl === child.url %}active{% endif %}"
                >
                  {{ child.title }}
                </a>

                {# ── LEVEL 3 ── expand only if we’re under this child #}
                {% if child.children and child.url and currentUrl and currentUrl.startsWith(child.url) %}
                  <ul>
                    {% for grandchild in child.children %}
                      <li>
                        <a
                          href="{{ grandchild.url }}"
                          class="{% if currentUrl === grandchild.url %}active{% endif %}"
                        >
                          {{ grandchild.title }}
                        </a>
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</nav>
