{% set tree = collections.all | eleventyNavigation %}
{% set currentKey = page.eleventyNavigation.key %}

<nav class="sidebar">
  <button class="sidebar-toggle" …>☰ Menu</button>
  <ul class="sidebar-nav">
    {# Find the active top‐level node #}
    {% for node in tree %}
      {% if node.key == currentKey or node.children | map(attribute='key') | contains(currentKey) %}
        <li><strong>{{ node.title }}</strong></li>

        {% for section in node.children %}
          <li>
            <a href="{{ section.url }}" class="{% if page.url == section.url %}active{% endif %}">
              {{ section.title }}
            </a>

            {# Only descend into this one if we’re on it or one of its children #}
            {% if section.key == currentKey or (section.children | map(attribute='key') | contains(currentKey)) %}
              <ul>
                {% for leaf in section.children %}
                  <li>
                    <a href="{{ leaf.url }}" class="{% if page.url == leaf.url %}active{% endif %}">
                      {{ leaf.title }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}

          </li>
        {% endfor %}

      {% endif %}
    {% endfor %}
  </ul>
</nav>
